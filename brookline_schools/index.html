<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
  <title>Campgrounds</title>
  <style>
    #map {
      width: 100%;
      height: 700px;
    }
  </style>
  <script src="https://maps.googleapis.com/maps/api/js"></script>
</head>
<body>
  <!--
  https://appendto.com/2016/08/interactive-mapping-with-python-geojson-and-javascript/
  -->
  <div id="map"></div>
  <script>
    var map
    var markers = []

    // after the geojson is loaded, iterate through the map data to create markers
    // and add the pop up (info) windows
    function loadMarkers() {
    console.log('creating markers')
    var infoWindow = new google.maps.InfoWindow()
    map.data.forEach(function(feature) {

      // geojson format is [longitude, latitude] but google maps marker position attribute
      // expects [latitude, longitude]
      var latitude = feature.getGeometry().get().lat()
      var longitude = feature.getGeometry().get().lng()
      var titleText = feature.getProperty('title')
      var descriptionText = feature.getProperty('description')

      var marker = new google.maps.Marker({
        position: {lat: latitude, lng:longitude},
        title: titleText,
        map: map
       });

      var markerInfo = "<div><h3>" + titleText + "</h3>Amenities: " + descriptionText + "</div>"

      // by default the infoWindow for each marker will stay open unless manually closed
      // using setContent and opening the window whenever a marker is clicked will
      // cause the prior infoWindow to close

      marker.addListener('click', function() {
            infoWindow.close()
            infoWindow.setContent(markerInfo)
            infoWindow.open(map, marker)
          });
      markers.push(marker)
    });
    }

    function initMap() {
      map_options = {
        zoom: 13,
        mapTypeId: google.maps.MapTypeId.HYBRID,
        center: {lat: 42.3318, lng: -71.1212}
      }

      map_document = document.getElementById('map')
      map = new google.maps.Map(map_document,map_options);
      geojson_url = {
        "type": "FeatureCollection",
        "features": [
          { "type": "Feature",
            "geometry": {
              "type": "Point",
              "coordinates": [-71.1300527,42.3334308]
            },
            "properties": {
              "title": "Brookline High School",
              "description": "The local high school"
            }
          },
          { "type": "Feature",
            "geometry": {
              "type": "Point",
              "coordinates": [-71.1194968,42.3356531]
            },
            "properties": {
              "title": "Pierce School",
              "description": "The local middle school"
            }
          }
        ]
      }

      console.log('loading geojson')
      map.data.loadGeoJson(geojson_url, null, loadMarkers)

    }

    google.maps.event.addDomListener(window, 'load', initMap);
  </script>
</body>
</html>
